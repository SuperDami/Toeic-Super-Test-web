<!DOCTYPE html>
<html>
    <head>
    <title>Toeic</title>
    <link rel='stylesheet' type='text/css' href='/style/stylesheet.css'/>
    <style type="text/css">
    	input {float:both; margin-left: 20px; font-size: 16px; border: none; background: none;}
    	input#restore {float:right; margin-right: 20px};
    	hr {color: gray;}
    	.downloadBtn {border-width: 1px; border-radius: 2px; border-color:black; margin-top: 0px; margin-bottom: 0px; clear: both; color:white; background-color: #72AB12; font-size:12px;}
    	.cellCover {width:140px; height: 180px;}
    </style>
    <script type="text/javascript">
    	function collectionSelect(sender) {
    		var buttons = document.getElementsByName("button");
    		for (var i = buttons.length - 1; i >= 0; i--) {
    			if (buttons[i] !== sender) {
    				buttons[i].style.color = "gray";
    			}
    			else {
    				buttons[i].style.color = "black";
    			}
    		};
    	}

    	function downloadTest(test) {
            console.log(test);
			var url = 'com.alc.topic.supertest://' + encodeURIComponent(test.testId) + '/' + encodeURIComponent(test.title) + '/' + encodeURIComponent(test.zipUrl) + '/' + encodeURIComponent(test.coverImageUrl);
			window.location = url; 
    	}

        function goToPage(pageIndex) {
            window.location = "?page=" + pageIndex; 
        }

	</script>
	</head>
	<body>
		<div id='container' style="width:100%; height:100%" style="text-align:center;">
			<div id='header' style="width:100%; text-align:center;">
				<img src='http://www.eurocentres.com/sites/default/files/styles/ec_header_image/public/course_toeic_panorama.jpg?itok=lN6Xrgx4' style="margin:0 auto"  />
			</div>
			<form>
				<input type='button' name='button' id='popularBtn' value='人気 コンテンシ' onclick="collectionSelect(this)">
				<input type='button' name='button' id='myTest' value='マイ ライブラリ' onclick="collectionSelect(this)">
				<input type='button' name='button' id='restore' value='リストア' onclick='collectionSelect(this)'>
			</form>
			<hr/>

            <% var gridHeight = 250*Math.ceil(testList.length / 4); %>
			<div style="width:100%; height:<%=gridHeight%>px; text-align:center;">
                <div style="position:absolute">
                <% 
                    for (var i = 0; i < testList.length; i++) { 
                    var test = testList[i];
                    var left = 20 + (i % 4) * 140 + ((i % 4) - 1)*10;
                    var top = Math.floor(i/4)*230 + Math.floor(i/4 + 1)*10;
                %>
                    <div style='width:140px; height:230px; float:left; text-align: center; position:absolute; left:<%=left%>px; top:<%=top%>px'>
                        <img src='<%=test.coverImageUrl%>' class='cellCover'>
                        <p style="clear:both; margin-top: 0px; margin-bottom: 0px; font-size:12px;"><%=test.title%></p>
                        <% if(!test.downloaded) {%>
                            <button class='downloadBtn' onclick='downloadTest(<%-JSON.stringify(test)%>)'>ダウンロード</button>
                        <% } else { %>
                            <p style="color:gray; clear:both; margin-top: 0px; margin-bottom: 0px; font-size:12px;">ダウンロード済み</p>
                        <% } %>
                    </div>
                <% } %>
                </div>
			</div>

            <div style="width:100%; height:40px; text-align:center;">
                <% if(prePage) { %>
                    <% var page = pageIndex - 1 %>
                    <button class="page" onclick="goToPage(<%=page%>)">
                <% } else { %>
                    <button class="page" disabled>
                <% } %>
                <<<</button>

                <a><%=pageIndex + 1%>/<%=pageCount%></a>

                <% if(nextPage) { %>
                    <% var page = pageIndex + 1 %>
                    <button class="page" onclick="goToPage(<%=page%>)">
                <% } else { %>
                    <button class="page" disabled>
                <% } %>
                >>></button>
            </div>
		</div>
	</body>
</html>