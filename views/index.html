<!DOCTYPE html>
<html>
    <head>
    <title>Toeic</title>
    <link rel='stylesheet' type='text/css' href='/style/stylesheet.css'/>
    <script type="text/javascript">
    	function collectionSelect(category) {
            window.location = "com.alc.topic.supertest.category://" + "category=" + encodeURIComponent(category);
    	}

        function goToPage(pageIndex, category) {
            window.location = "com.alc.topic.supertest.goToPage://" + "page=" + encodeURIComponent(pageIndex) + "&category=" + encodeURIComponent(category); 
        }

        function purchase(test, category) {
            console.log("category :", category);
            window.location = 'com.alc.topic.supertest.purchase://' + "testId=" + encodeURIComponent(test.testId) + "&productId=" + encodeURIComponent(test.productId) + "&category=" + encodeURIComponent(category);
        }

    	function downloadTest(test, category) {
            var json = JSON.stringify(test);

            var form = document.createElement("form");
            form.setAttribute("action", "/downloadTest");
            form.setAttribute("method", "post");
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", "test");
            hiddenField.setAttribute("value", json);

            form.appendChild(hiddenField);
            document.body.appendChild(form);
            form.submit();
    	}
	</script>
	</head>
	<body>
		<div id='container' style="width:600px; height:100%; text-align:center;">
			<div id='header' style="width:100%; text-align:center;">
				<img src='/images/header_ad.png' style="width:100%; margin:0 auto"  />
			</div>
            <div style="width:100%; height:27px;">
                <input type='button' class="categoryBtn" style="float:left" value='人気 コンテンシ' onclick="collectionSelect('popular')">
                <input type='button' class="categoryBtn" style="float:left; margin-left:16px" value='マイ•ライブラリ' onclick="collectionSelect('myLibrary')">
                <input type='button' class="categoryBtn" style="float:right; background-image:url('/images/restore_btn.png'); background-repeat:no-repeat;" onclick="collectionSelect('restore')">
            </div>
            <hr style="color:#AAAAAA;" noshade>

            <% var gridHeight = 290*Math.ceil(testList.length / 4); %>
            <% if ((!testList.length)&&(category==='myLibrary')) { %>
                <div style="text-align:center; height:340px">
                <div style="width:100%; height:auto; text-align:center;">
                    <img src="/images/restore_icon.png" style="margin:40px auto 0px auto">
                    <div class="tipTitle" row="1">表示するコンテンツがありません</div>
                    <div class="tipContent" row="3">［リストア］ボタンをタップし、既にご購入済みのコンテンツは課金されずにダウンロードいただけます。</div>
                </div>
            <% } else { %>
                <div style="width:100%; height:<%=gridHeight%>px; text-align:center;">
                <div style="position:absolute">
                <% 
                    for (var i = 0; i < testList.length; i++) { 
                    var test = testList[i];
                    var left = 20 + (i % 4) * 140 + ((i % 4) - 1)*10;
                    var top = Math.floor(i/4)*270 + Math.floor(i/4 + 1)*10;
                %>
                    <div class="cell" style='float:left; text-align: center; position:absolute; left:<%=left%>px; top:<%=top%>px'>
                        <img class="cellCover" src='<%=test.coverImageUrl%>'>
                        <div class="title" rows="2"><%=test.title%></div>
                        <% if(test.status === "downloaded") {%>
                            <label class="downloadedLabel">ダウンロード済み</label>
                        <% } else if(test.status === "purchased") { %>
                            <button class='downloadBtn' onclick='downloadTest(<%-JSON.stringify(test)%>, "<%=category%>")'>ダウンロード</button>
                        <% } else { %>
                            <button class='purchaseBtn' onclick='purchase(<%-JSON.stringify(test)%>, "<%=category%>")'>¥<%=test.price%></button>
                        <% } %>
                    </div>
                <% } %>
                </div>                
            <% } %>
			</div>

            <div style="width:100%; height:40px; text-align:center;">
                <% if(prePage) { %>
                    <% var page = pageIndex - 1 %>
                    <button class="page" onclick="goToPage(<%=page%>, '<%=category%>')">
                <% } else { %>
                    <button class="page" disabled>
                <% } %>
                <<<</button>

                <a><%=pageIndex + 1%>/<%=pageCount%></a>

                <% if(nextPage) { %>
                    <% var page = pageIndex + 1 %>
                    <button class="page" onclick="goToPage(<%=page%>, '<%=category%>')">
                <% } else { %>
                    <button class="page" disabled>
                <% } %>
                >>></button>
            </div>
		</div>
	</body>
</html>